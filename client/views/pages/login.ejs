<div class="error box-shadow page-section error" id="error-card"></div>
<div class="loading box-shadow page-section" id="loading-card">
    <div style="display: block; justify-content: center">
        <div class="spinner-border" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>

<div class="login box-shadow page-section">
    <div class="form-group">
        <label>Email address</label>
        <input id="email" type="email" class="form-control">
        <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
    </div>
    <div class="form-group">
        <label>Password</label>
        <input id="password" type="password" class="form-control">
    </div>
    <div class="form-group form-check">
        <input id="remember" type="checkbox" class="form-check-input">
        <label class="form-check-label">Remember Me</label>
    </div>
    <button id="login-btn" class="btn btn-primary">Login</button>
</div>

<div class="login box-shadow page-section">
    <a href="/auth/signup">
        <button id="signup-btn" class="btn btn-primary">Signup?</button>
    </a>
    <a>
        <button id="google-btn" class="btn btn-danger">Google Login</button>
    </a>
</div>

<script>
    document.getElementById("login-btn").addEventListener("click", function () {
        let email = document.getElementById("email")?.value;
        let pass = document.getElementById("password")?.value;
        let remember = document.getElementById("remember")?.checked;
        let url = window.location.origin + "/api/v1/auth/login"
        let success = window.location.origin + "/"

        let loadingCard = document.getElementById("loading-card");
        loadingCard.style.display = "flex";

        fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                email: email,
                password: pass,
                expires: !remember
            })
        })
            .then(response => response.json())
            .then(data => {
                loadingCard.style.display = "none";
                if (!data.success) {
                    document.getElementById("error-card").style.display = "block";
                    document.getElementById("error-card").innerHTML = ""
                    data.errors.forEach(error => {
                        document.getElementById("error-card").innerHTML += `<b> - \t${error}<br/></b>`;
                    });

                } else {
                    window.location.href = success
                    window.localStorage.setItem("token", data.token);
                    window.localStorage.setItem("admin", data.admin);
                    data.displayName ? window.localStorage.setItem("displayName", data.displayName) :
                        null;
                }
            });
    })

    document.getElementById("google-btn").addEventListener("click", function () {
        let email = document.getElementById("email")?.value;
        let pass = document.getElementById("password")?.value;
        let remember = document.getElementById("remember")?.checked;
        let url = window.location.origin + "/api/v1/auth/login"
        let success = window.location.origin + "/"

        let loadingCard = document.getElementById("loading-card");
        loadingCard.style.display = "flex";

        fetch(url, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                email: email,
                password: pass,
                expires: !remember
            })
        })
            .then(response => response.json())
            .then(data => {
                loadingCard.style.display = "none";
                if (!data.success) {
                    document.getElementById("error-card").style.display = "block";
                    document.getElementById("error-card").innerHTML = ""
                    data.errors.forEach(error => {
                        document.getElementById("error-card").innerHTML += `<b> - \t${error}<br/></b>`;
                    });

                } else {
                    window.location.href = success
                    window.localStorage.setItem("token", data.token);
                    window.localStorage.setItem("admin", data.admin);
                    data.displayName ? window.localStorage.setItem("displayName", data.displayName) :
                        null;
                }
            });
    })
</script>
